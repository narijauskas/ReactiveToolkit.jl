<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Extras · ReactiveToolkit.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img class="docs-light-only" src="../assets/logo.svg" alt="ReactiveToolkit.jl logo"/><img class="docs-dark-only" src="../assets/logo-dark.svg" alt="ReactiveToolkit.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">ReactiveToolkit.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../manual/">Manual</a></li><li class="is-active"><a class="tocitem" href>Extras</a><ul class="internal"><li><a class="tocitem" href="#Topics-vs-Captured-Variables"><span>Topics vs Captured Variables</span></a></li><li><a class="tocitem" href="#Timing"><span>Timing</span></a></li><li><a class="tocitem" href="#Topic/Task-Generators"><span>Topic/Task Generators</span></a></li><li><a class="tocitem" href="#Custom-Message-Types"><span>Custom Message Types</span></a></li><li><a class="tocitem" href="#Automatic-Plotting"><span>Automatic Plotting</span></a></li><li><a class="tocitem" href="#Performance"><span>Performance</span></a></li><li><a class="tocitem" href="#Blink"><span>Blink</span></a></li><li><a class="tocitem" href="#Utilities"><span>Utilities</span></a></li><li><a class="tocitem" href="#Future"><span>Future</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Extras</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Extras</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/narijauskas/ReactiveToolkit.jl/blob/main/docs/src/extras.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Examples-and-Design-Patterns"><a class="docs-heading-anchor" href="#Examples-and-Design-Patterns">Examples and Design Patterns</a><a id="Examples-and-Design-Patterns-1"></a><a class="docs-heading-anchor-permalink" href="#Examples-and-Design-Patterns" title="Permalink"></a></h1><p>These are fairly minimal toy examples. Many of them may not be a good idea, or lead to something that is a bad idea. For now, please treat them as food for thought.</p><h2 id="Topics-vs-Captured-Variables"><a class="docs-heading-anchor" href="#Topics-vs-Captured-Variables">Topics vs Captured Variables</a><a id="Topics-vs-Captured-Variables-1"></a><a class="docs-heading-anchor-permalink" href="#Topics-vs-Captured-Variables" title="Permalink"></a></h2><p>As a closure:</p><pre><code class="language-julia hljs">@after seconds(3) begin
    i = 0
    task = @every millis(5) println(&quot;hello! i=$(i+=1)&quot;)
    @after seconds(3) kill(task)
end
# i is not defined</code></pre><p>As a topic:</p><pre><code class="language-julia hljs">@topic j = 0
@after seconds(3) begin
    task = @every millis(5) println(&quot;hello! j[]=$(j[]+=1)&quot;)
    @after seconds(3) kill(task)
end
# j[] is 600</code></pre><h2 id="Timing"><a class="docs-heading-anchor" href="#Timing">Timing</a><a id="Timing-1"></a><a class="docs-heading-anchor-permalink" href="#Timing" title="Permalink"></a></h2><p>Windows 11 22H2: <img src="../assets/sleep_windows.png" alt="timing"/> ReactiveToolkit.jl: <img src="../assets/sleep_rtk.png" alt="timing"/></p><h2 id="Topic/Task-Generators"><a class="docs-heading-anchor" href="#Topic/Task-Generators">Topic/Task Generators</a><a id="Topic/Task-Generators-1"></a><a class="docs-heading-anchor-permalink" href="#Topic/Task-Generators" title="Permalink"></a></h2><p>Sometimes we want lots of tasks that are almost identical, but with different parameters. Why not use a loop to build them? (see tests_compound.jl)</p><h2 id="Custom-Message-Types"><a class="docs-heading-anchor" href="#Custom-Message-Types">Custom Message Types</a><a id="Custom-Message-Types-1"></a><a class="docs-heading-anchor-permalink" href="#Custom-Message-Types" title="Permalink"></a></h2><p>Since topics can hold any julia type, messages can be defined by whatever type we want. This includes custom structs:</p><pre><code class="language-julia hljs">struct RobotStatus
    battery_level::Float64
    is_ok::Bool
end
@topic status = RobotStatus(100, true)</code></pre><p>existing data structures and container types:</p><pre><code class="language-julia hljs">@topic status = (100, true)
@topic status = Dict(&quot;battery_level&quot;=&gt;100, &quot;is_ok&quot;=&gt;true)
@topic status = (battery_level=100, is_ok=true)
@topic status = &quot;BATT:100,ISOK:1&quot;</code></pre><p>or <em>literally</em> anything:</p><pre><code class="language-julia hljs">@topic status::Any = (100, true)
status[] = Dict(&quot;battery_level&quot;=&gt;100, &quot;is_ok&quot;=&gt;true)
status[] = &quot;I hope this doesn&#39;t break anything&quot;</code></pre><p>You may see why this isn&#39;t necessarily a good idea. But it&#39;s possible!</p><h2 id="Automatic-Plotting"><a class="docs-heading-anchor" href="#Automatic-Plotting">Automatic Plotting</a><a id="Automatic-Plotting-1"></a><a class="docs-heading-anchor-permalink" href="#Automatic-Plotting" title="Permalink"></a></h2><p>If we lean into the abstraction, we can do things like this:</p><pre><code class="language-julia hljs">using ReactiveToolkit
using CairoMakie

@topic idx = 1
@topic fig = Figure()
@topic data = Vector{Float64}[]

@on fig &quot;autosave&quot; begin
    save(&quot;./plots/figure_$(idx[]).png&quot;, fig[])
    idx[] += 1
end

@on data &quot;autoplot&quot; begin
    fig[] = lines(data[])
end

# now we can automatically plot and save data simply by storing it:
data[] = rand(10)</code></pre><h2 id="Performance"><a class="docs-heading-anchor" href="#Performance">Performance</a><a id="Performance-1"></a><a class="docs-heading-anchor-permalink" href="#Performance" title="Permalink"></a></h2><p>It is difficult to make fair, direct comparisons between <code>ReactiveToolkit.jl</code> and other real-time/robotics frameworks such as ROS or LCM because this package is fairly unique in how it works and what it does. <strong>With this in mind,</strong> consider the basic operation of a reactive framework: one task reacting to a value generated by another task.</p><p>In the context of ROS, this would be a publisher node publishing to a topic and triggering a callback function of a subscriber node. In the context of <code>ReactiveToolkit.jl</code>, this would be:</p><pre><code class="language-julia hljs">@topic x = 0
@on x do_something()
x[] = 1
# something is done</code></pre><p>For such an operation, <code>ReactiveToolkit.jl</code> will be some <strong>10,000x faster than ROS</strong>.</p><p>What?</p><p>Again, this is not a fair or direct comparison. ROS nodes are independent processes, and ROS marshalls data between them using TCP/IP. This adds the overhead of serialization, the several steps of the TCP/IP transfer itself, potentially additional transfers to ensure delivery, the OS scheduling the other process, performing a context switch, and finally deserialization. In contrast, <code>ReactiveToolkit.jl</code> runs entirely within a single (preferrably multi-threaded) julia process, and its &quot;nodes&quot; are concurrent tasks with a shared memory pool. Marshalling data becomes a simple matter of mutual exclusion, with the overhead reduced to the few microseconds needed to acquire a lock.</p><h2 id="Blink"><a class="docs-heading-anchor" href="#Blink">Blink</a><a id="Blink-1"></a><a class="docs-heading-anchor-permalink" href="#Blink" title="Permalink"></a></h2><p>Blinking an LED on a microcontroller 10 times a second could be done as follows:</p><pre><code class="language-julia hljs">using ReactiveToolkit
using LibSerialPort

@topic led_cmd = false
mcu = SerialPort(&quot;COM3&quot;)

@every millis(100) &quot;led blinker&quot; begin
    !isopen(mcu) &amp;&amp; open(mcu)
end begin
    led_cmd[] = !led_cmd[]
    write(mcu, &quot;set led $(led_cmd[])\r\n&quot;)
end begin
    isopen(mcu) &amp;&amp; close(mcu)
end</code></pre><p>Note that this example assumes a microcontroller with native USB (like a Teensy 4.x or ESP32-S3) on port <code>COM3</code> with firmware set up to react to the serial commands <code>set led false</code> and <code>set led true</code>. Older microcontrollers (which use a UART-based FTDI chip to implement USB communication) will also need a baud rate set as the second argument to the SerialPort constructor.</p><p>Also note that serial transfers have a non-negligible latency, so this design pattern is not a good idea above ~200Hz.</p><h2 id="Utilities"><a class="docs-heading-anchor" href="#Utilities">Utilities</a><a id="Utilities-1"></a><a class="docs-heading-anchor-permalink" href="#Utilities" title="Permalink"></a></h2><p>Consider the task which monitors x and prints its value whenever it changes:</p><pre><code class="language-julia hljs">@on x &quot;x monitor&quot; println(&quot;x is now: $(x[])&quot;)</code></pre><p>A useful design pattern is to wrap a commonly used task template in a constructor function. We can then use and reuse this constructor to generate tasks with behavior that can be customized to a given context via its arguments. For example, this is exactly how we imlement <code>ReactiveToolkit.echo</code>:</p><pre><code class="language-julia hljs">echo(x::AbstractTopic) = @on x &quot;echo $(x.name)&quot; println(x.name, &quot;: &quot;, x[])</code></pre><pre><code class="language-julia hljs">@topic x = 0
echo_x = echo(x)
# while active, the echo_x task will print the value of x whenever it changes
kill(echo_x)</code></pre><h2 id="Future"><a class="docs-heading-anchor" href="#Future">Future</a><a id="Future-1"></a><a class="docs-heading-anchor-permalink" href="#Future" title="Permalink"></a></h2><p>Here are some things I&#39;m considering to add in the future:</p><ul><li>operators on topics in the style of eg. <code>Reactive.jl</code>, like <code>merge</code>, <code>filter</code>, <code>foldp</code>, etc.</li><li>cleaner mutation of topics containing mutable types (eg. <code>push!(x[], 5)</code> should work intuitively).</li><li>a universal serialization scheme for marshalling of topics.</li><li>a cpp implementation of the serializer, to facilitate communication with microcontrollers.</li><li>UDP communication/UDPTopics</li><li>integration utilities for eg. ROS, LCM, etc.</li><li>built-in support for various interfaces (eg. serial, HID, UDP, etc.)</li><li>throttling of task updates (user adjustable, defaulting to something like a few MHz)</li><li>compound triggers like <code>@onany</code> and <code>@onall</code></li><li>pop-up terminal in a separate window dedicated for log/info messages</li><li>a clean way to restrict tasks to the main thread for packages which don&#39;t play well with multithreading (I&#39;ve had some issues with Makie.jl jumping threads)</li><li>thread pools and task priorities</li><li>documentation on using ReactiveToolkit with existing primitives like Channels</li><li>graph visualization of the task network</li><li>real-time plotting</li><li>logging utilities</li><li>smarter, more useful, adjustable buffer sizes for topics</li></ul><p>A UDP backend would allow inter-process and inter-device communication. I have been playing with some prototypes, and almost made it the default <code>Topic</code> type, but chose not to because:</p><ol><li>UDP is not nearly as fast as shared memory</li><li>UDP requires a good serialization/deserialization scheme</li><li>Julia&#39;s UDP stack relies on calls to lib_uv, which I believe are serialized</li></ol></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../manual/">« Manual</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Monday 27 November 2023 02:49">Monday 27 November 2023</span>. Using Julia version 1.9.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
